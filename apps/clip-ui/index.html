<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Slotpaste Chooser</title>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, sans-serif; font-size: 13px; background: #1e1e1e; }
    #chooser { padding: 10px 14px; background: rgba(30,30,30,0.92); border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
    #mode { color: #aaa; margin-bottom: 8px; font-size: 11px; }
    #slots { display: flex; gap: 6px; flex-wrap: wrap; }
    .slot { width: 38px; height: 38px; border: 1px solid #555; border-radius: 6px; background: #444; color: #fff; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 600; line-height: 1.2; }
    .slot small { font-size: 9px; opacity: 0.9; }
    .slot:hover { background: #555; border-color: #888; }
    .slot:active { background: #666; }
  </style>
</head>
<body>
  <div id="chooser">
    <div id="mode">Save to slot</div>
    <div id="slots">
      <button class="slot" data-slot="1">1<br><small>J</small></button>
      <button class="slot" data-slot="2">2<br><small>K</small></button>
      <button class="slot" data-slot="3">3<br><small>L</small></button>
      <button class="slot" data-slot="4">4<br><small>U</small></button>
      <button class="slot" data-slot="5">5<br><small>I</small></button>
      <button class="slot" data-slot="6">6<br><small>O</small></button>
    </div>
  </div>
  <script type="module">
    window.__CHOOSER_TOKEN__ = null;
    window.__CHOOSER_MODE__ = 'save';
    window.__CHOOSER_TIMEOUT__ = null;

    const invoke = window.__TAURI__?.core?.invoke;
    if (!invoke) {
      console.warn('Tauri invoke not available');
    }
    function sendChosen(slot) {
      if (!window.__CHOOSER_TOKEN__ || !invoke) return;
      invoke('send_chosen', { token: window.__CHOOSER_TOKEN__, slot });
      window.__CHOOSER_TOKEN__ = null;
      clearTimeout(window.__CHOOSER_TIMEOUT__);
      invoke('hide_chooser');
    }
    function sendCancel(reason) {
      if (!window.__CHOOSER_TOKEN__ || !invoke) return;
      invoke('send_cancel', { token: window.__CHOOSER_TOKEN__, reason });
      window.__CHOOSER_TOKEN__ = null;
      clearTimeout(window.__CHOOSER_TIMEOUT__);
      invoke('hide_chooser');
    }

    document.querySelectorAll('.slot').forEach(btn => {
      btn.addEventListener('click', () => sendChosen(parseInt(btn.dataset.slot, 10)));
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { sendCancel('esc'); e.preventDefault(); return; }
      const n = parseInt(e.key, 10);
      if (n >= 1 && n <= 6) {
        if (window.__CHOOSER_MODE__ === 'paste') { sendChosen(n); e.preventDefault(); }
        else if (e.altKey) { sendChosen(n); e.preventDefault(); }
      }
    });

    window.__TAURI__?.event?.listen('chooser-show', (ev) => {
      const { mode, token, timeout_ms } = ev.payload || {};
      window.__CHOOSER_TOKEN__ = token || null;
      window.__CHOOSER_MODE__ = mode || 'save';
      document.getElementById('mode').textContent = mode === 'paste' ? 'Paste from slot' : 'Save to slot';
      clearTimeout(window.__CHOOSER_TIMEOUT__);
      window.__CHOOSER_TIMEOUT__ = setTimeout(() => sendCancel('timeout'), timeout_ms || 800);
    });
  </script>
</body>
</html>
